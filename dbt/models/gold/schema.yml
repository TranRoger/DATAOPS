version: 2

models:
  - name: gld_customer_metrics
    description: "Gold layer: Customer-level aggregated metrics and KPIs for customer lifetime value analysis and segmentation"
    columns:
      - name: customer_id
        description: "Unique customer identifier (Primary Key)"
        tests:
          - unique
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: int

      - name: full_name
        description: "Customer full name for reporting and visualization"
        tests:
          - not_null

      - name: territory_id
        description: "Sales territory for geographic analysis"

      - name: total_orders
        description: "Total number of orders placed by customer (order count, not line items)"
        tests:
          - not_null

      - name: total_revenue
        description: "Lifetime revenue generated by customer - sum of all line_total across all orders"
        tests:
          - not_null

      - name: avg_order_value
        description: "Average order line value - used for customer segmentation and upsell targeting"

      - name: total_items_purchased
        description: "Total quantity of items purchased across all orders"
        tests:
          - not_null

      - name: first_order_date
        description: "Date of customer's first purchase - used for cohort analysis and customer tenure calculations"

      - name: last_order_date
        description: "Date of customer's most recent purchase - critical for churn prediction and reactivation campaigns"

      - name: orders_with_discount
        description: "Count of orders where customer received discount - indicates price sensitivity"
        tests:
          - not_null

  - name: gld_product_performance
    description: "Gold layer: Product-level sales performance and profitability metrics for merchandising decisions and inventory optimization"
    columns:
      - name: product_id
        description: "Unique product identifier (Primary Key)"
        tests:
          - unique
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: int

      - name: product_name
        description: "Product name for reporting"
        tests:
          - not_null

      - name: subcategory_name
        description: "Product subcategory for category-level analysis"
        tests:
          - not_null

      - name: color
        description: "Product color attribute"
        tests:
          - not_null

      - name: list_price
        description: "Current list price from product master"
        tests:
          - not_null

      - name: standard_cost
        description: "Manufacturing/acquisition cost used for profit calculations"
        tests:
          - not_null

      - name: total_orders
        description: "Number of distinct orders containing this product"
        tests:
          - not_null

      - name: total_quantity_sold
        description: "Total units sold - key metric for inventory planning and reorder decisions"
        tests:
          - not_null

      - name: total_revenue
        description: "Total revenue generated by product - sum of all line_total for this product"
        tests:
          - not_null

      - name: avg_selling_price
        description: "Average unit price achieved (may differ from list_price due to discounts)"

      - name: total_profit
        description: "Calculated: Total profit (revenue - cost*quantity) - absolute profit contribution"

      - name: profit_margin_pct
        description: "Calculated: Profit margin percentage ((revenue - cost) / revenue * 100) - efficiency metric for pricing strategy"

  - name: gld_sales_summary
    description: "Gold layer: Daily sales summary with key business metrics for executive dashboards and trend analysis"
    columns:
      - name: order_date
        description: "Order date (Primary Key) - aggregated to day level for time series analysis"
        tests:
          - unique
          - not_null

      - name: total_orders
        description: "Count of distinct orders placed on this date"
        tests:
          - not_null

      - name: unique_customers
        description: "Count of distinct customers who placed orders - used for active user metrics"
        tests:
          - not_null

      - name: total_items_sold
        description: "Total quantity of items sold across all orders - volume metric"
        tests:
          - not_null

      - name: total_revenue
        description: "Total revenue for the day - primary KPI for sales performance tracking"
        tests:
          - not_null

      - name: avg_order_line_value
        description: "Average value per order line item - basket size indicator"

      - name: online_orders
        description: "Count of online channel orders - for channel mix analysis"
        tests:
          - not_null

      - name: offline_orders
        description: "Count of offline channel orders - for channel mix analysis"
        tests:
          - not_null

      - name: discounted_revenue
        description: "Revenue from orders with discounts applied - measures promotional impact"
        tests:
          - not_null
